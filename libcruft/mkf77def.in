#! /bin/sh

SED=${SED:-'sed'}
AWK=${AWK:-'awk'}

F77_TOLOWER=%F77_APPEND_UNDERSCORE%
F77_APPEND_UNDERSCORE=%F77_APPEND_UNDERSCORE%
F77_APPEND_EXTRA_UNDERSCORE=%F77_APPEND_EXTRA_UNDERSCORE%

if $F77_TOLOWER; then
  case_cmd="tolower";
else
  case_cmd="toupper";
fi

if $F77_APPEND_UNDERSCORE; then
  uscore="_";
else
  uscore="";
fi

if $F77_APPEND_EXTRA_UNDERSCORE; then
  awkcmd="$AWK '{ if (\$0 ~ /_/) extra = \"_\"; else extra = \"\"; printf (\"%s%s%s\n\", $case_cmd (\$0), \"$uscore\", extra); }'"
else
  awkcmd="$AWK '{ printf (\"%s%s\n\", tolower (\$0), \"$uscore\"); }'"
fi

$SED -n -e 's/^[ \t]*\([Ff][Uu][Nn][Cc][Tt][Ii][Oo][Nn]\|[Ss][Uu][Bb][Rr][Oo][Uu][Tt][Ii][Nn][Ee]\|[Ee][Nn][Tt][Rr][Yy]\)[ \t]*\([^ \t(]*\).*$/\2/p' | \
  eval $awkcmd
