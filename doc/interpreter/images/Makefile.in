TOPDIR = ../../..

srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@

include $(TOPDIR)/Makeconf

SOURCES = sparseimages.m

SPARSEIMAGES_1 = gplot grid spmatrix spchol spcholperm
SPARSEIMAGES = \
  $(addsuffix .eps, $(SPARSEIMAGES_1)) \
  $(addsuffix .png, $(SPARSEIMAGES_1)) \
  $(addsuffix .txt, $(SPARSEIMAGES_1))
IMAGES += $(SPARSEIMAGES) $(addsuffix .pdf, $(SPARSEIMAGES_1))

DISTFILES = Makefile.in $(SOURCES) $(IMAGES)

all: $(IMAGES)
.PHONY: all

define run-octave
  $(TOPDIR)/run-octave -f -q -H -p $(srcdir) \
    --eval "$(notdir $(basename $<)) ('$(notdir $(basename $@))', '$(patsubst .%,%, $(suffix $@))')"
endef

$(SPARSEIMAGES): sparseimages.m
	$(run-octave)

%.pdf : %.eps
	if [ -f $< ] ; then gs -dBATCH -dEPSCrop -dNOPAUSE -q -sDEVICE=pdfwrite -sOutputFile=$@ $< ; fi

install install-strip:
.PHONY: install install-strip

uninstall:
.PHONY: uninstall

tags: $(SOURCES)
	ctags $(SOURCES)

TAGS: $(SOURCES)
	etags $(SOURCES)

clean:
.PHONY: clean

mostlyclean:
.PHONY: mostlyclean

distclean: clean
	rm -f Makefile
.PHONY: distclean

maintainer-clean: distclean
	rm -f tags TAGS
	rm -f $(IMAGES)
.PHONY: maintainer-clean

dist:
	ln $(DISTFILES) ../../../`cat ../../../.fname`/doc/interpreter/images
.PHONY: dist
