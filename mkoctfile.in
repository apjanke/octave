#! /bin/sh
#
# mkoctfile -- create a .oct file suitable for dynamic linking by
# Octave.

set -e

if [ $# -eq 1 ]; then
  srcfile="$1"
  basnm=`echo $srcfile | sed 's,\.cc$,,'`
  objfile=$basnm.o
  octfile=$basnm.oct
else
  echo "usage: mkoctfile file.cc" 1>&2
  exit 1
fi

# Configuration:  these variables are filled in at configuration time.

CPPFLAGS=%CPPFLAGS%
INCFLAGS=%INCFLAGS%
CXX=%CXX%
CXX_VERSION=%CXX_VERSION%
CXXFLAGS=%CXXFLAGS%
CXXPICFLAG=%CXXPICFLAG%
HOST_CXXFLAGS=%HOST_CXXFLAGS%
NO_IMPLICIT_TEMPLATES=%NO_IMPLICIT_TEMPLATES%
GCC_IEEE_FP_FLAG=%GCC_IEEE_FP_FLAG%

SH_LD=%SH_LD%
SH_LDFLAGS=%SH_LDFLAGS%

ALL_CXXFLAGS="$INCFLAGS $HOST_CXXFLAGS $NO_IMPLICIT_TEMPLATES \
  $GCC_IEEE_FP_FLAG $CXXFLAGS"

echo "making $objfile from $srcfile"

eval $CXX -c $CPPFLAGS $CXXPICFLAG $ALL_CXXFLAGS $srcfile -o $objfile

echo "making $octfile from $objfile"

eval $SH_LD $SH_LDFLAGS -o $octfile $objfile
