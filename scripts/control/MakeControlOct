%.oct : %.cc $(OCT_LIBS) ocst.h
	@echo "making $@ from $<"
	mkoctfile $<  -locst -lm

%.o : %.cc ocst.h
	@echo "making $@ from $<"
	mkoctfile $<
	rm -f $*.oct

OCT_FILES = abcddim.oct \
	fir2sys.oct \
	ss2sys.oct \
	tf2sys.oct \
	zp2sys.oct \
	#sysout.oct \
	zgsgiv.oct

OCST_LIB = get_complex_vector.o  \
	get_matrix.o \
	get_real_scalar.o  \
	get_string_matrix.o  \
	get_string.o  \
	get_vect.o \
	pack.o \
	sysdefioname.o \
	sysdefstname.o

OCT_LIBS=

all: $(OCT_LIBS) $(OCT_FILES)
	@echo ""
	octave

libocst.so: $(OCST_LIB)
	gcc -fPIC -shared -R/opt/octave/lib -o libocst.so.1 $(OCST_LIB)
	cp libocst.so.1 /opt/octave/lib
	rm -f /opt/octave/lib/libocst.so
	ln -s /opt/octave/lib/libocst.so.1 /opt/octave/lib/libocst.so
	rm -f ./libocst.so
	ln -s ./libocst.so.1 ./libocst.so

ABCDDIM_DEP= abcddim.cc \
	zero_matrix.o
abcddim.oct: $(ABCDDIM_DEP) ocst.h
	mkoctfile $(ABCDDIM_DEP)

FIR2SYS_DEP= fir2sys.cc \
	get_real_scalar.o \
	get_string.o \
	get_vector.o \
	pack.o 
fir2sys.oct: $(FIR2SYS_DEP) ocst.h
	mkoctfile $(FIR2SYS_DEP)

SS2SYS_DEP= ss2sys.cc \
	$(ABCDDIM_DEP) \
	add_name.o \
	get_matrix.o \
	get_real_scalar.o \
	get_string_matrix.o \
	get_vector.o \
	pack.o \
	sysdefioname.o \
	sysdefstname.o  
ss2sys.oct: $(SS2SYS_DEP) ocst.h
	mkoctfile $(SS2SYS_DEP)

SYSOUT_DEP= sysout.cc
sysout.oct: $(SYSOUT_DEP) ocst.h
	mkoctfile $(SYSOUT_DEP)

TF2SYS_DEP= tf2sys.cc \
	get_real_scalar.o \
	get_string.o \
	get_vector.o \
	pack.o 
tf2sys.oct: $(TF2SYS_DEP) ocst.h
	mkoctfile $(TF2SYS_DEP)

ZGSGIV_DEP=zgsgiv.cc
zgsgiv.oct: $(ZGSGIV_DEP) ocst.h
	mkoctfile $(ZGSGIV_DEP)

ZP2SYS_DEP= zp2sys.cc \
	get_complex_vector.o \
	get_real_scalar.o \
	get_string.o \
	pack.o 
zp2sys.oct: $(ZP2SYS_DEP) ocst.h
	mkoctfile $(ZP2SYS_DEP)

clean:
	rm -f *.o *.oct *.a *.so *.so.1

